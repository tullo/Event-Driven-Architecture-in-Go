# changelog

`docker compose --profile microservices up`

`go test -v ./testing/e2e/*.go`

Test output:

```sh
=== RUN   TestEndToEnd
Feature: Adding items
  As a customer with a basket I can add items

  Background:
    Given I am a registered customer      # <autogenerated>:1 -> *customersFeature
    And I start a new basket              # <autogenerated>:1 -> *basketsFeature

  Scenario: Adding items                  # features/baskets/add_item.feature:9
    Given a store has the following items # <autogenerated>:1 -> *storesFeature
      | Name              | Price |
      | Wizard w/ crystal | 9.99  |
    When I add the items                  # <autogenerated>:1 -> *basketsFeature
      | Name              | Quantity |
      | Wizard w/ crystal | 10       |
    Then the items are added              # <autogenerated>:1 -> *basketsFeature

  Scenario: Cannot add items that do not exist                                # features/baskets/add_item.feature:18
    When I add the items                                                      # <autogenerated>:1 -> *basketsFeature
      | Name              | Quantity |
      | Wizard w/ crystal | 10       |
    Then I receive a "product fallback failed: product was not located" error # e2e_test.go:120 -> command-line-arguments.iReceiveAError

Feature: Starting baskets
  As a customer I can start new shopping baskets

  Scenario: Create a basket              # features/baskets/start_basket.feature:5
    Given I am a registered customer     # <autogenerated>:1 -> *customersFeature
    When I start a new basket            # <autogenerated>:1 -> *basketsFeature
    Then I expect the basket was started # <autogenerated>:1 -> *basketsFeature

Feature: Register Customer

  Scenario: Registering a new customer             # features/customers/register_customer.feature:3
    Given no customer named "John Smith" exists    # <autogenerated>:1 -> *customersFeature
    When I register a new customer as "John Smith" # <autogenerated>:1 -> *customersFeature
    Then I expect the customer is created          # <autogenerated>:1 -> *customersFeature

Feature: Creating products
  As a store owner
  I should be able to create new store products

  Background:
    Given the store "Nic & Naks" already exists                            # <autogenerated>:1 -> *storesFeature

  Scenario: Creating a product called "Wizard w/ crystal"                  # features/stores/create_product.feature:9
    Given a valid store owner                                              # <autogenerated>:1 -> *storesFeature
    When I create the product called "Wizard w/ crystal" with price "9.98" # <autogenerated>:1 -> *storesFeature
    Then I expect the product was created                                  # <autogenerated>:1 -> *storesFeature

Feature: Creating stores
  As a store owner
  I should be able to create new stores

  Scenario: Creating a store called "Waldorf Books" # features/stores/create_store.feature:6
    Given a valid store owner                       # <autogenerated>:1 -> *storesFeature
    And no store called "Waldorf Books" exists      # <autogenerated>:1 -> *storesFeature
    When I create the store called "Waldorf Books"  # <autogenerated>:1 -> *storesFeature
    Then the store is created                       # <autogenerated>:1 -> *storesFeature

  Scenario: Cannot create stores without a name             # features/stores/create_store.feature:12
    Given a valid store owner                               # <autogenerated>:1 -> *storesFeature
    When I create a store called ""                         # <autogenerated>:1 -> *storesFeature
    Then I receive a "the store name cannot be blank" error # e2e_test.go:120 -> command-line-arguments.iReceiveAError

7 scenarios (7 passed)
26 steps (26 passed)
1.589901038s

Randomized with seed: 77775
--- PASS: TestEndToEnd (1.60s)
PASS
ok  	command-line-arguments	1.611s
```

Compose log:

```log
customers      | INF --> Customers.RegisterCustomer
customers      | INF --> Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.RegisterCustomer
proxy          | "POST /api/customers"
baskets        | INF --> Baskets.StartBasket
baskets        | INF --> Baskets.DomainEvents.On(baskets.BasketStarted)
baskets        | INF <-- Baskets.DomainEvents.On(baskets.BasketStarted)
baskets        | INF <-- Baskets.StartBasket
proxy          | "POST /api/baskets"
stores         | INF --> Stores.CreateStore
stores         | INF --> Stores.Mall.On(stores.StoreCreated)
stores         | INF <-- Stores.Mall.On(stores.StoreCreated)
stores         | INF --> Stores.DomainEvents.On(stores.StoreCreated)
stores         | INF <-- Stores.DomainEvents.On(stores.StoreCreated)
stores         | INF <-- Stores.CreateStore
proxy          | "POST /api/stores"
stores         | INF --> Stores.AddProduct
stores         | INF --> Stores.Catalog.On(stores.ProductAdded)
stores         | INF <-- Stores.Catalog.On(stores.ProductAdded)
stores         | INF --> Stores.DomainEvents.On(stores.ProductAdded)
stores         | INF <-- Stores.DomainEvents.On(stores.ProductAdded)
stores         | INF <-- Stores.AddProduct
proxy          | "POST /api/stores/feeae125-d3d6-4071-85c5-8a5e56a43f6a/products"
baskets        | INF --> Baskets.AddItem
stores         | INF --> Stores.GetProduct
stores         | INF <-- Stores.GetProduct
stores         | INF --> Stores.GetStore
stores         | INF <-- Stores.GetStore
baskets        | INF <-- Baskets.AddItem
proxy          | "PUT /api/baskets/0694e64c-b0dc-4ad0-9199-c8552a631eaa/addItem"
customers      | INF --> Customers.RegisterCustomer
customers      | INF --> Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.RegisterCustomer
proxy          | "POST /api/customers"
baskets        | INF --> Baskets.StartBasket
baskets        | INF --> Baskets.DomainEvents.On(baskets.BasketStarted)
baskets        | INF <-- Baskets.DomainEvents.On(baskets.BasketStarted)
baskets        | INF <-- Baskets.StartBasket
proxy          | "POST /api/baskets"
baskets        | INF --> Baskets.AddItem
stores         | INF --> Stores.GetProduct
stores         | INF <-- Stores.GetProduct error="product with that ID does not exist"
baskets        | INF <-- Baskets.AddItem error="product fallback failed: product was not located"
proxy          | "PUT /api/baskets/75fd023d-8240-43c0-8368-1941fbd48ab8/addItem"
customers      | INF --> Customers.RegisterCustomer
customers      | INF --> Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.RegisterCustomer
proxy          | "POST /api/customers"
baskets        | INF --> Baskets.StartBasket
baskets        | INF --> Baskets.DomainEvents.On(baskets.BasketStarted)
baskets        | INF <-- Baskets.DomainEvents.On(baskets.BasketStarted)
baskets        | INF <-- Baskets.StartBasket
proxy          | "POST /api/baskets"
customers      | INF --> Customers.RegisterCustomer
customers      | INF --> Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.DomainEvents.On(customers.CustomerRegistered)
customers      | INF <-- Customers.RegisterCustomer
proxy          | "POST /api/customers"
notifications  | INF --> Notifications.IntegrationEvents.On(customersapi.CustomerRegistered)
search         | INF --> Payments.IntegrationEvents.On(customersapi.CustomerRegistered)
search         | INF <-- Payments.IntegrationEvents.On(customersapi.CustomerRegistered)
notifications  | INF <-- Notifications.IntegrationEvents.On(customersapi.CustomerRegistered)
stores         | INF --> Stores.CreateStore
stores         | INF --> Stores.Mall.On(stores.StoreCreated)
stores         | INF <-- Stores.Mall.On(stores.StoreCreated)
stores         | INF --> Stores.DomainEvents.On(stores.StoreCreated)
stores         | INF <-- Stores.DomainEvents.On(stores.StoreCreated)
stores         | INF <-- Stores.CreateStore
proxy          | "POST /api/stores"
stores         | INF --> Stores.AddProduct
stores         | INF --> Stores.Catalog.On(stores.ProductAdded)
stores         | INF <-- Stores.Catalog.On(stores.ProductAdded)
stores         | INF --> Stores.DomainEvents.On(stores.ProductAdded)
stores         | INF <-- Stores.DomainEvents.On(stores.ProductAdded)
stores         | INF <-- Stores.AddProduct
proxy          | "POST /api/stores/db10d98a-a2e8-4744-826c-b69083b1b90d/products"
search         | INF --> Payments.IntegrationEvents.On(storesapi.ProductAdded)
depot          | INF --> Depot.IntegrationEvents.On(storesapi.ProductAdded)
baskets        | INF --> Baskets.IntegrationEvents.On(storesapi.ProductAdded)
search         | INF <-- Payments.IntegrationEvents.On(storesapi.ProductAdded)
baskets        | INF <-- Baskets.IntegrationEvents.On(storesapi.ProductAdded)
depot          | INF <-- Depot.IntegrationEvents.On(storesapi.ProductAdded)
depot          | INF --> Depot.IntegrationEvents.On(storesapi.StoreCreated)
depot          | INF <-- Depot.IntegrationEvents.On(storesapi.StoreCreated)
baskets        | INF --> Baskets.IntegrationEvents.On(storesapi.StoreCreated)
baskets        | INF <-- Baskets.IntegrationEvents.On(storesapi.StoreCreated)
search         | INF --> Payments.IntegrationEvents.On(storesapi.StoreCreated)
search         | INF <-- Payments.IntegrationEvents.On(storesapi.StoreCreated)
stores         | INF --> Stores.CreateStore
stores         | INF --> Stores.Mall.On(stores.StoreCreated)
stores         | INF <-- Stores.Mall.On(stores.StoreCreated)
stores         | INF --> Stores.DomainEvents.On(stores.StoreCreated)
stores         | INF <-- Stores.DomainEvents.On(stores.StoreCreated)
stores         | INF <-- Stores.CreateStore
proxy          | "POST /api/stores"
stores         | INF --> Stores.CreateStore
stores         | INF <-- Stores.CreateStore error="the store name cannot be blank"
proxy          | "POST /api/stores"
```
